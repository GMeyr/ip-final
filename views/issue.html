<!DOCTYPE html>
<html>
  <head>
   <meta charset="UTF-8">
    <title>Issue Prism</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

  </head>

  <body>
    <h1 class="logo">issueprism</h1>
    <div class="navbar">
      <p><a href="/">Home</a> &nbsp; <a href="/addissue">Add Issue</a></p>
    </div>
    <div class="issueContent">
      <div class="issueTypeScope"></div>
      <div class="issueTitle"></div>
      <div class="issueText"></div>
    </div>
    <div>
      <span class="allprocomments">
        Pro Comments  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
      </span>
      <span class="allconcomments">
        Con Comments
      </span>
    </div>
     <input type="button" id="commentButton" value="Add Comment">

    <div class="addCommentForm">
      <form id="newCommentForm" action="/comment/" method="post">
        <p>Side:<br>
          <input type="radio" name="commside" value="pro" checked>Pro
          <input type="radio" name="commside" value="con">Con
        </p>
        <p>Comment:<br>
          <input type="text" name="commtext" ><br>
          <span class="helpertext">Make sure it's a question</span>
        </p>
        <p>Reference Link:<br>
          <input type="text" name="commref" ><br>
        </p>
        <p>Comment Type:<br>
          <input type="radio" name="commtype" value="statistical" checked>Statistical
          <input type="radio" name="commtype" value="rational">Rational
          <input type="radio" name="commtype" value="moral">Moral
          <input type="radio" name="commtype" value="anecdotal">Anecdotal
        </p>
        <p><input type="submit" value="Submit Comment" /></p>
      </form>
    </span>

    <script>

    // global variables
          var pathArray = window.location.search.slice(5);

    // Comment Form Functionality

          $('#newCommentForm').append('<input type="hidden" name="commissue_id" value="' + pathArray + '" />');

          $('.addCommentForm').hide();

          $('#commentButton').click(function(){
              $('.addCommentForm').toggle();
          });

    // GET issue

          $(function (){
            var idPath = "/id/?_id=" + pathArray;
            $.ajax({
              type: "GET",
              url: idPath,
              success: function(data) {
               var dataObj = {
                                _id: JSON.stringify(data._id).replace(/\"/g, ""),
                                title: JSON.stringify(data.title).replace(/\"/g, ""),
                                text: JSON.stringify(data.text).replace(/\"/g, ""),
                                type: JSON.stringify(data.type).replace(/\"/g, ""),
                                scope: JSON.stringify(data.scope).replace(/\"/g, "")
                              };
                console.log("The dataObj should have these props: " + dataObj.title + " " + dataObj.text);
                  $('.issueTypeScope').html("<p>" + dataObj.type + " : " + dataObj.scope + "</p>");
                  $('.issueTitle').html("<h2>" + dataObj.title + "</h2>");
                  $('.issueText').html("<p>" + dataObj.text + "</p>");

              }
            });
          });

    // GET pro comments
    $(function (){
              var comments_url = "/getcomments/?_id=" + pathArray + "&side=pro";
    $.ajax({
      type: "GET",
      url: comments_url,
      success: function(data) {
        console.log(JSON.stringify(data.allCommentArr));
        /*var con_arrays_obj = data;
        con_arrays_obj.allCommentArr.forEach(function (x){
          console.log(x);
          var dataArrObj = {
                    title: JSON.stringify(x.title).replace(/\"/g, ""),
                    text: JSON.stringify(x.text).replace(/\"/g, ""),
                    ref: JSON.stringify(x.ref).replace(/\"/g, ""),
                    posted: JSON.stringify(x.posted).replace(/\"/g, ""),
                  };
         $('.allprocomments').append("<p class='posted_date'>" + dataArrObj.posted + "</p><p class='comment_text'>" + dataArrObj.text + "</p><p class='ref'><a href='" + dataArrObj.ref + "'>" + dataArrObj.ref + "</a></p>");
                    }
       );*/}
    });
});

    // GET con comments
                $(function (){
                          var comments_url = "/getcomments/?_id=" + pathArray + "&side=con";
                $.ajax({
                  type: "GET",
                  url: comments_url,
                  success: function(data) {
                    console.log(JSON.stringify(data.allCommentArr));
                    /*var con_arrays_obj = data;
                    con_arrays_obj.allCommentArr.forEach(function (x){
                      console.log(x);
                      var dataArrObj = {
                                title: JSON.stringify(x.title).replace(/\"/g, ""),
                                text: JSON.stringify(x.text).replace(/\"/g, ""),
                                ref: JSON.stringify(x.ref).replace(/\"/g, ""),
                                posted: JSON.stringify(x.posted).replace(/\"/g, ""),
                              };
                     $('.allconcomments').append("<p class='posted_date'>" + dataArrObj.posted + "</p><p class='comment_text'>" + dataArrObj.text + "</p><p class='ref'><a href='" + dataArrObj.ref + "'>" + dataArrObj.ref + "</a></p>");
                                }
                   );*/}
                });
          });
    </script>
  </body>
</html>
